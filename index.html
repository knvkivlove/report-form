<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Отчёт</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f4f7f6; /* Светло-серый фон */
        padding: 20px;
      }

      h2 {
        color: #007bff; /* Яркий заголовок */
        margin-bottom: 25px;
        font-weight: 300;
      }

      form {
        max-width: 420px;
        margin: 20px auto;
        padding: 30px;
        border: 1px solid #dee2e6;
        border-radius: 12px;
        background-color: #ffffff; /* Белый фон формы */
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .form-group {
        margin-bottom: 20px;
        text-align: center;
      }

      /* Стили для всех полей ввода и выбора */
      select,
      input[type="number"],
      input[type="text"],
      input[type="password"] {
        padding: 10px;
        width: 100%;
        box-sizing: border-box;
        margin-top: 5px;
        border: 1px solid #ced4da;
        border-radius: 6px;
        transition: border-color 0.3s, box-shadow 0.3s;
      }

      select:focus,
      input:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        outline: none;
      }

      label {
        display: block;
        margin-top: 5px;
        font-size: 14px;
        color: #495057;
        font-weight: 600;
      }

      /* Группы в одну линию (Месяц/Год) */
      .inline-group {
        display: flex;
        justify-content: space-between;
        gap: 15px;
        align-items: flex-end;
        margin-bottom: 20px;
      }

      .inline-group > div {
        flex: 1;
      }

      /* Группы радио-кнопок и чекбоксов */
      .radio-group,
      .checkbox-group {
        display: flex;
        justify-content: center;
        gap: 20px;
        align-items: center;
        margin-bottom: 20px;
        border: 1px solid #e9ecef;
        padding: 10px;
        border-radius: 8px;
        background-color: #f8f9fa;
      }

      .radio-option {
        display: flex;
        align-items: center;
      }

      .radio-option label {
        margin: 0 0 0 8px;
        font-weight: normal;
        font-size: 1rem;
        cursor: pointer;
      }

      /* Стиль для большого чекбокса */
      .checkbox-group input[type="checkbox"] {
        transform: scale(1.2);
        margin-right: 5px;
      }

      .checkbox-group label {
        font-weight: bold;
        font-size: 14px;
        color: #212529;
        user-select: none;
      }

      /* Новый стиль для поля Изучения Библии рядом с чекбоксом */
      .inline-study {
        display: flex; /* Важно, чтобы flex работал */
        justify-content: center;
        margin-top: -10px; /* Приподнять поле ближе к чекбоксу */
      }

      .inline-study > div {
        max-width: 150px; /* Ограничиваем ширину для ПК (30% от 420px) */
        width: 100%;
        text-align: center;
      }

      /* Стили для поля Часы */
      .hours-group input[type="number"] {
        max-width: 150px; /* Ограничиваем ширину поля, чтобы оно не было слишком широким */
        margin-left: auto;
        margin-right: auto;
      }

      /* Кнопка */
      button {
        padding: 12px 25px;
        font-size: 18px;
        cursor: pointer;
        margin-top: 15px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        transition: background-color 0.3s, transform 0.1s;
        width: 100%; /* Делаем кнопку шире */
      }

      button:hover {
        background-color: #0056b3;
      }

      button:active {
        transform: scale(0.99);
      }

      button:disabled {
        background-color: #a0c3e7;
        cursor: not-allowed;
      }

      .hours-group {
        display: none;
      }

      /* ======================================================= */
      /* Адаптивность для маленьких экранов (Медиа-запрос) */
      /* ======================================================= */
      @media (max-width: 500px) {
        /* Увеличение ширины поля ФИО */
        input[type="text"] {
          max-width: 90%; /* Позволяем полю ФИО быть шире */
          margin-left: auto;
          margin-right: auto;
        }

        /* Поля Месяц/Год в столбик на мобильном */
        .inline-group {
          flex-direction: column;
          gap: 10px;
        }

        .inline-group > div {
          width: 70%;
          max-width: 70%;
          margin-left: auto;
          margin-right: auto;
        }

        /* Радио-кнопки в столбик для лучшей читаемости */
        .radio-group {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
          width: 90%;
          margin-left: auto;
          margin-right: auto;
        }

        /* Выделяем "Возвещатель" на отдельную строку */
        .radio-group > .radio-option:nth-child(3) {
          order: -1;
          margin-bottom: 5px;
        }

        /* Группируем ОП и ПП */
        .radio-group > .radio-option:nth-child(1),
        .radio-group > .radio-option:nth-child(2) {
          margin-right: 20px;
        }

        /* Увеличение ширины поля Изучения Библии на мобильном */
        .inline-study > div {
          max-width: 70%;
        }

        /* Увеличение ширины поля Часы на мобильном */
        .hours-group input[type="number"] {
          max-width: 70%;
        }
      }
    </style>
    <script>
      // Глобальная переменная для iframe
      let submitted = false;

      // ФУНКЦИЯ, КОТОРАЯ ДОЛЖНА ПОКАЗЫВАТЬ/СКРЫВАТЬ ПОЛЕ
      function toggleHoursField() {
        const selectedOption = document.querySelector(
          'input[name="status"]:checked'
        ).value;
        const hoursField = document.getElementById("hours-group");

        // Добавлено: Защита от случая, когда элемент 'hours-group' не найден
        if (!hoursField) {
          console.error("Элемент 'hours-group' не найден!");
          return;
        }

        // Поле показывается, если выбрано "ОП" ИЛИ "ПП"
        hoursField.style.display =
          selectedOption === "ОП" || selectedOption === "ПП" ? "block" : "none";
      }

      // НОВАЯ ФУНКЦИЯ для обработки нажатия кнопки
      function submitForm(event) {
        // Если браузерная валидация не прошла, эта функция не выполнится,
        // но на всякий случай можно добавить:
        if (!document.getElementById("reportForm").checkValidity()) {
          return;
        }
        submitted = true;

        // 1. Сбор данных для сообщения об успехе
        const month = document.getElementById("month").value;
        const year = document.getElementById("year").value;
        const participated = document.getElementById("participated").checked;
        const bibleStudies =
          document.getElementById("bibleStudies").value || "0";
        const status = document.querySelector(
          'input[name="status"]:checked'
        ).value;
        const hours =
          document.getElementById("hours-group").style.display === "block"
            ? document.getElementById("hours").value
            : "0"; // Если часы не введены, ставим 0 для сообщения

        // Формирование текста сообщения (без HTML-тегов)
        let participationText = participated
          ? "Участвовал/а: ✅ Да"
          : "Участвовал/а: ❌ Нет";

        let reportDetails = `Отчет за ${month}, ${year} успешно отправлен!`;

        let dataSummary = `
            ${participationText} 
            Изучения: ${bibleStudies}
            Статус: ${status}
            Часы: ${hours}
        `;

        // Сохраняем данные для отображения в iframe
        localStorage.setItem("reportDetails", reportDetails);
        localStorage.setItem("dataSummary", dataSummary);

        // 2. Блокируем кнопку и отправляем форму
        document.getElementById("reportForm").submit();

        const button = document.querySelector('button[type="submit"]');
        button.textContent = "Отправка...";
        button.disabled = true;

        setTimeout(() => {
          button.textContent = "Отправить";
          button.disabled = false;
        }, 5000);
      }

      // ВЫЗОВ ФУНКЦИИ ПРИ ЗАГРУЗКЕ СТРАНИЦЫ
      document.addEventListener("DOMContentLoaded", toggleHoursField);
    </script>
  </head>
  <body>
    <h2 style="text-align: center">Отчёт</h2>
    <form
      id="reportForm"
      action="https://script.google.com/macros/s/AKfycbwIje7--KzFqEL17wEsWgQkaCHHCqe7pOeR3RV_hhv61Y1IBSE8w14DA0-aIVpFlaEkRQ/exec"
      method="POST"
      target="hidden_iframe"
      onsubmit="submitForm(event)"
    >
      <div class="inline-group">
        <div>
          <select id="month" name="month" required>
            <option value="" disabled selected>Выберите месяц</option>
            <option value="Январь">Январь</option>
            <option value="Февраль">Февраль</option>
            <option value="Март">Март</option>
            <option value="Апрель">Апрель</option>
            <option value="Май">Май</option>
            <option value="Июнь">Июнь</option>
            <option value="Июль">Июль</option>
            <option value="Август">Август</option>
            <option value="Сентябрь">Сентябрь</option>
            <option value="Октябрь">Октябрь</option>
            <option value="Ноябрь">Ноябрь</option>
            <option value="Декабрь">Декабрь</option>
          </select>
          <label for="month">Месяц</label>
        </div>

        <div>
          <input type="number" id="year" name="year" required />
          <label for="year">Год</label>
        </div>
      </div>

      <div class="form-group">
        <input
          type="text"
          id="lastName"
          name="lastName"
          list="lastNames"
          required
        />
        <label for="lastName">Фамилия Имя</label>
        <datalist id="lastNames">
          <option value="Бережанская Светлана"></option>
          <option value="Бондарь Алёна"></option>
          <option value="Бухаленко Вера"></option>
          <option value="Воронкова Елена"></option>
          <option value="Гаркуша Ольга"></option>
          <option value="Герман Даниил"></option>
          <option value="Глущенко Татьяна"></option>
          <option value="Гнатченко Нинель"></option>
          <option value="Гринькова Инна"></option>
          <option value="Гура Людмила"></option>
          <option value="Дедова Любовь"></option>
          <option value="Демидчук Людмила"></option>
          <option value="Долгих Надежда"></option>
          <option value="Доценко Вера"></option>
          <option value="Дубовик Мария"></option>
          <option value="Жилина Екатерина"></option>
          <option value="Запорожец Анна"></option>
          <option value="Зотчик Валентина"></option>
          <option value="Иргалеева Нина"></option>
          <option value="Каблукова Раиса"></option>
          <option value="Калинец Наталья"></option>
          <option value="Киндерева Лидия"></option>
          <option value="Кисель Светлана"></option>
          <option value="Клименко Анжела"></option>
          <option value="Ковалёва Виолетта"></option>
          <option value="Ковалёва Ольга"></option>
          <option value="Ковтун Вера"></option>
          <option value="Колесник Ольга"></option>
          <option value="Колодяжный Владимир"></option>
          <option value="Колтовская Екатерина"></option>
          <option value="Корнеев Иван"></option>
          <option value="Корнеева Галина"></option>
          <option value="Корнеева Галина_2"></option>
          <option value="Криворучко Виталий"></option>
          <option value="Криворучко Ира"></option>
          <option value="Куделя Лариса"></option>
          <option value="Кузнецова Людмила"></option>
          <option value="Кучеренко Александр"></option>
          <option value="Кучеренко Юлия"></option>
          <option value="Кучма Виктория"></option>
          <option value="Литвинова Ольга"></option>
          <option value="Лысенко Валерий"></option>
          <option value="Лысенко Тамара"></option>
          <option value="Мамедов Николай"></option>
          <option value="Манько Виктор"></option>
          <option value="Манько Татьяна"></option>
          <option value="Медведев Валерий"></option>
          <option value="Медведева Надежда"></option>
          <option value="Мельник Светлана"></option>
          <option value="Милютина Оксана"></option>
          <option value="Мухина Ольга"></option>
          <option value="Назаренко Алла"></option>
          <option value="Ногова Ирина"></option>
          <option value="Овсюк Алёна"></option>
          <option value="Орлова Светлана"></option>
          <option value="Пархомчук Лилия"></option>
          <option value="Пасечник Тамара"></option>
          <option value="Пивень Валентина"></option>
          <option value="Погребняк Любовь"></option>
          <option value="Полтавец Алина"></option>
          <option value="Полтавец Анна"></option>
          <option value="Полтавец Владислав"></option>
          <option value="Полтавец Елена"></option>
          <option value="Полтавец Илья"></option>
          <option value="Посыльная Галина"></option>
          <option value="Работа Татьяна"></option>
          <option value="Романько Алёна"></option>
          <option value="Сагайдачная Любовь"></option>
          <option value="Салева Екатерина"></option>
          <option value="Санькова Светлана"></option>
          <option value="Сидельник Тамара"></option>
          <option value="Скиба Людмила"></option>
          <option value="Соболь Анатолий"></option>
          <option value="Соснина Любовь"></option>
          <option value="Стручевская Нина"></option>
          <option value="Терновая Серафима"></option>
          <option value="Тимошинов Олег"></option>
          <option value="Тимошинова Татьяна"></option>
          <option value="Тищенко Людмила"></option>
          <option value="Третьяк Елена"></option>
          <option value="Трубицина Лариса"></option>
          <option value="Трубицина Людмила"></option>
          <option value="Унгул Нина"></option>
          <option value="Файн Ирина"></option>
          <option value="Харченко Виктор"></option>
          <option value="Харченко Елена"></option>
          <option value="Харченко Наталья"></option>
          <option value="Хомут Андрей"></option>
          <option value="Хомут Виталий"></option>
          <option value="Хомут Ольга"></option>
          <option value="Чекмарёва Ия"></option>
          <option value="Чёрная Валентина"></option>
          <option value="Чернышева Валида"></option>
          <option value="Шило Екатерина"></option>
          <option value="Щитова Людмила"></option>
          <option value="Ющишина Алла"></option>
          <!-- Дополните список до 100 фамилий -->
        </datalist>
      </div>

      <div class="checkbox-group form-group">
        <input type="checkbox" id="participated" name="participated" />
        <label for="participated">Участвовал/а в служении</label>
      </div>
      <div class="inline-group inline-study">
        <div>
          <input
            type="number"
            id="bibleStudies"
            name="bibleStudies"
            placeholder="0"
            min="0"
            step="1"
            value="0"
          />
          <label for="bibleStudies">Изучения Библии</label>
        </div>
      </div>

      <div class="radio-group">
        <div class="radio-option">
          <input
            type="radio"
            id="op"
            name="status"
            value="ОП"
            onclick="toggleHoursField()"
          />
          <label for="op">ОП</label>
        </div>
        <div class="radio-option">
          <input
            type="radio"
            id="pp"
            name="status"
            value="ПП"
            onclick="toggleHoursField()"
          />
          <label for="pp">ПП</label>
        </div>
        <div class="radio-option">
          <input
            type="radio"
            id="publisher"
            name="status"
            value="Возвещатель"
            onclick="toggleHoursField()"
            checked
          />
          <label for="publisher">Возвещатель</label>
        </div>
      </div>
      <div class="form-group hours-group" id="hours-group">
        <input
          type="number"
          id="hours"
          name="hours"
          placeholder="0"
          min="0"
          step="1"
        />
        <label for="hours">Часы (целое число)</label>
      </div>
      <div class="form-group">
        <input
          type="password"
          id="password"
          name="password"
          required
          placeholder="Введите ваш пароль"
        />
        <label for="password">Личный пароль для передачи отчета</label>
      </div>
      <div class="form-group">
        <button type="submit">Отправить</button>
      </div>
    </form>
    <iframe
      name="hidden_iframe"
      id="hidden_iframe"
      style="display: none"
      onload="if(submitted) {
        // Получаем сохраненные данные
        const details = localStorage.getItem('reportDetails');
        const summary = localStorage.getItem('dataSummary');

        // Упрощаем сообщение для alert(), используя только символы новой строки (\n)
        // Удаляем все HTML-теги и заменяем разделители на простой текст
        let cleanSummary = summary
            .replace(/<br>/g, '')
            .replace(/&nbsp;/g, ' ')
            .replace(/\*\*/g, '') // Удаляем жирность (**)
            .replace(/\|/g, ' | '); // Заменяем | на пробел|пробел

        const finalMessage = details.replace(/\*\*/g, '') + '\n\nСводка:' + cleanSummary;

        // Показываем сообщение и обрабатываем сброс формы
        alert(finalMessage);

        // Сброс и очистка
        document.getElementById('reportForm').reset(); 
        document.getElementById('hours-group').style.display = 'none'; 
        submitted = false;
        localStorage.removeItem('reportDetails');
        localStorage.removeItem('dataSummary');
    }"
    ></iframe>
  </body>
</html>
